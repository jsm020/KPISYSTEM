{% load static %}
<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kafedralar Jadvali</title>
    <link rel="stylesheet" href="{% static 'css/main_admin.css' %}">

</head>
<body>
    <header>
        <div class="logo">
            <img src="{% static 'images/KPI_logo.png' %}" alt="Logo">
        </div> 
        <div class="account">
            <div class="account-name">
                <img src="{% static 'images/1.png' %}" alt="User">
                <span>{{request.user.first_name}}</span>
            </div>
            <div class="dropdown-content">
                <a href="{% url 'logout' %}">Chiqish</a>
            </div>
        </div>
    </header>

    <!-- Table Section -->
    <table>
        <thead>
            <tr>
                <th>Kafedra nomi</th>
                <th>FISh</th>
                <th>Ilmiy darajasi</th>
                <th>Shtat birligi</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for data in user_data %}
            <tr>
                <td></td>  <!-- Change based on the data you want to display -->
                <td><a href="{% url 'view_name' data.user.username %}">{{ data.user.username }}</a></td> <!-- Change based on the data you want to display -->
                <td>{{ data.user.email }}</td> <!-- Change this based on user fields -->
                <td>1.0</td>
                <td>
                    <div class="action-icons">
                        <span class="action-simport requests
import json

# API ma'lumotlari
base_url = "https://student.samdukf.uz/rest/v1/data/student-list?page={}"
max_page = 128
token = "YOUR_TOKEN_HERE"  # Bu yerda tokeningizni kiritasiz
headers = {
    "Authorization": f"Bearer {token}"
}
all_data = []

# Har bir sahifadan ma'lumotlarni yig'ish
for page in range(1, max_page + 1):
    url = base_url.format(page)
    response = requests.get(url, headers=headers)  # Tokenni headers orqali yuborish
    
    if response.status_code == 200:
        data = response.json()  # API'dan kelgan JSON'ni olamiz
        items = data.get("data", {}).get("items", [])  # 'items' qismini olamiz
        all_data.extend(items)  # 'items' ro'yxatini umumiy ro'yxatga qo'shamiz
    else:
        print(f"Page {page} ga ulanishda xatolik: {response.status_code}")

# Natijani JSON faylga yozish
with open("student_data.json", "w") as json_file:
    json.dump(all_data, json_file, indent=4)

print(f"Yig'ilgan ma'lumotlar 'student_data.json' fayliga saqlandi.")
tatus" 
                              onclick="showPopup(this, '{{ data.user.username }} qo\'shgan nimadir')">
                              {{ data.none_count }}
                        </span>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
        
    </table>

    <!-- Popup Container -->
    <div id="popup" class="popup">
        <button class="close-btn" onclick="closePopup()">X</button>
        <p id="popup-content"></p>
    </div>

    <script>
        // Show the popup with the information
        function showPopup(element, message) {
            var popup = document.getElementById('popup');
            var popupContent = document.getElementById('popup-content');
            popupContent.textContent = message;

            // Position the popup near the clicked status
            var rect = element.getBoundingClientRect();
            popup.style.top = rect.top + window.scrollY + 30 + 'px';
            popup.style.left = rect.left + 'px';
            popup.style.display = 'block';
        }

        // Close the popup
        function closePopup() {
            document.getElementById('popup').style.display = 'none';
        }

        // Delete the row
        function deleteRow(element) {
            var row = element.closest('tr');
            row.parentNode.removeChild(row);
        }
    </script>
</body>
</html>
